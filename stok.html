<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Stok Bahan Ajar - SITTA UT</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body class="layout">
  <header class="header">
    <h1>Stok Bahan Ajar SITTA</h1>
    <nav>
      <a href="index.html">üè† Beranda</a> |
      <a href="tracking.html">üöö Tracking DO</a>
    </nav>
  </header>

  <main id="stok-app" class="main">
    <section class="card">
      <h2>Filter & Sort Stok</h2>
      <div class="filters">
        <div class="filter-group">
          <label for="filter-upbjj">UT-Daerah</label>
          <select id="filter-upbjj" v-model="filters.selectedUpbjj">
            <option value="">-- Semua UT-Daerah --</option>
            <option v-for="u in upbjjList" :key="u" :value="u">{{ u }}</option>
          </select>
        </div>

        <div class="filter-group" v-if="filters.selectedUpbjj">
          <label for="filter-kategori">Kategori Mata Kuliah</label>
          <select id="filter-kategori" v-model="filters.selectedKategori">
            <option value="">-- Semua Kategori --</option>
            <option v-for="k in kategoriList" :key="k" :value="k">{{ k }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label>
            <input type="checkbox" v-model="filters.onlyBelowSafety" />
            Hanya stok &lt; safety
          </label>
        </div>

        <div class="filter-group">
          <label>
            <input type="checkbox" v-model="filters.onlyEmpty" />
            Hanya stok kosong (qty = 0)
          </label>
        </div>

        <div class="filter-group">
          <label for="sort-field">Sort by</label>
          <select id="sort-field" v-model="filters.sortField">
            <option value="judul">Judul</option>
            <option value="qty">Stok (Qty)</option>
            <option value="harga">Harga</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="sort-dir">Arah</label>
          <select id="sort-dir" v-model="filters.sortDir">
            <option value="asc">Naik (ASC)</option>
            <option value="desc">Turun (DESC)</option>
          </select>
        </div>

        <div class="filter-group">
          <button type="button" @click="resetFilters">Reset Filter</button>
        </div>
      </div>

      <p class="info">
        Menampilkan {{ filteredAndSortedStok.length }} dari {{ stok.length }} data stok.
        <br />
        <small>{{ filterInfoMessage }}</small>
      </p>
    </section>

    <section class="card">
      <h2>Daftar Stok Bahan Ajar</h2>
      <div class="table-wrapper">
        <table class="data-table">
          <thead>
          <tr>
            <th>Kode</th>
            <th>Judul</th>
            <th>Kategori</th>
            <th>UT-Daerah</th>
            <th>Lokasi Rak</th>
            <th>Harga</th>
            <th>Qty</th>
            <th>Safety</th>
            <th>Status</th>
            <th>Catatan</th>
            <th>Aksi</th>
          </tr>
          </thead>
          <tbody>
          <tr v-for="(item, idx) in filteredAndSortedStok" :key="item.kode + '-' + idx">
            <td>{{ item.kode }}</td>
            <td>{{ item.judul }}</td>
            <td>{{ item.kategori }}</td>
            <td>{{ item.upbjj }}</td>
            <td>{{ item.lokasiRak }}</td>
            <td>{{ formatRupiah(item.harga) }}</td>
            <td>
              <input type="number" min="0" v-model.number="item.qty" class="inline-input" />
            </td>
            <td>
              <input type="number" min="0" v-model.number="item.safety" class="inline-input" />
            </td>
            <td>
              <span :class="['badge', statusClass(item)]">{{ statusText(item) }}</span>
            </td>
            <td v-html="item.catatanHTML"></td>
            <td>
              <button type="button" @click="saveRow(item)">üíæ Simpan</button>
            </td>
          </tr>
          <tr v-if="filteredAndSortedStok.length === 0">
            <td colspan="11" class="text-center">Tidak ada data yang cocok dengan filter.</td>
          </tr>
          </tbody>
        </table>
      </div>
      <p class="info"><small>{{ lastSaveMessage }}</small></p>
    </section>

    <section class="card">
      <h2>Tambah Stok Bahan Ajar Baru</h2>

      <div v-if="formErrors.length" class="alert alert-error">
        <p><strong>Periksa kembali input:</strong></p>
        <ul>
          <li v-for="(e, i) in formErrors" :key="i">{{ e }}</li>
        </ul>
      </div>

      <form @submit.prevent="submitNewStock" class="form-grid">
        <label>
          Kode Mata Kuliah
          <input type="text" v-model.trim="newStock.kode" />
        </label>

        <label>
          Judul Mata Kuliah
          <input type="text" v-model.trim="newStock.judul" />
        </label>

        <label>
          Kategori
          <select v-model="newStock.kategori">
            <option value="">-- Pilih Kategori --</option>
            <option v-for="k in kategoriList" :key="k" :value="k">{{ k }}</option>
          </select>
        </label>

        <label>
          UT-Daerah
          <select v-model="newStock.upbjj">
            <option value="">-- Pilih UT-Daerah --</option>
            <option v-for="u in upbjjList" :key="u" :value="u">{{ u }}</option>
          </select>
        </label>

        <label>
          Lokasi Rak
          <input type="text" v-model.trim="newStock.lokasiRak" />
        </label>

        <label>
          Harga
          <input type="number" min="0" v-model.number="newStock.harga" />
        </label>

        <label>
          Qty
          <input type="number" min="0" v-model.number="newStock.qty" />
        </label>

        <label>
          Safety Stock
          <input type="number" min="0" v-model.number="newStock.safety" />
        </label>

        <label class="full-width">
          Catatan (HTML)
          <textarea v-model="newStock.catatanHTML" rows="2"
            placeholder="Contoh: &lt;em&gt;Edisi baru&lt;/em&gt;"></textarea>
        </label>

        <div class="full-width">
          <button type="submit">‚ûï Tambah Stok</button>
        </div>
      </form>

      <p class="info">
        <small>{{ qtyHintMessage }}</small>
      </p>
    </section>
  </main>

  <footer class="footer">
    <small>&copy; 2025 SITTA UT - Halaman Stok Bahan Ajar</small>
  </footer>

  <!-- Vue.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
  <!-- Dummy data -->
  <script src="js/dataBahanAjar.js"></script>
  <!-- App logic -->
  <script src="js/stok-app.js"></script>
</body>
</html>
